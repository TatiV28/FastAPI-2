"""
–¢–µ—Å—Ç—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –∏ –ø–æ–∫—Ä—ã—Ç–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
–ó–∞–ø—É—Å–∫: python -m pytest test_blockchain.py -v
"""

import pytest
import uuid
import time
from main import (
    CryptoManager, UTXOManager, Blockchain, ABTestManager,
    Transaction, TransactionInput, TransactionOutput, ABTestGroup
)


class TestCryptoManager:
    """–¢–µ—Å—Ç—ã –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π"""
    
    def test_key_generation(self):
        """–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ RSA –∫–ª—é—á–µ–π"""
        keys = CryptoManager.generate_key_pair()
        
        assert "private_key" in keys
        assert "public_key" in keys
        assert "BEGIN PRIVATE KEY" in keys["private_key"]
        assert "BEGIN PUBLIC KEY" in keys["public_key"]
    
    def test_digital_signature(self):
        """–¢–µ—Å—Ç —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏"""
        keys = CryptoManager.generate_key_pair()
        message = "Test message for signing"
        
        # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        signature = CryptoManager.sign_data(keys["private_key"], message)
        assert isinstance(signature, str)
        assert len(signature) > 0
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å
        is_valid = CryptoManager.verify_signature(
            keys["public_key"], message, signature
        )
        assert is_valid is True
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
        is_valid_wrong = CryptoManager.verify_signature(
            keys["public_key"], "Wrong message", signature
        )
        assert is_valid_wrong is False
    
    def test_hash_function(self):
        """–¢–µ—Å—Ç —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è"""
        message = "Hello, blockchain!"
        hash1 = CryptoManager.hash_data(message)
        hash2 = CryptoManager.hash_data(message)
        
        # –•–µ—à–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å
        assert hash1 == hash2
        assert len(hash1) == 64  # SHA-256 = 32 –±–∞–π—Ç–∞ = 64 hex —Å–∏–º–≤–æ–ª–∞
        
        # –•–µ—à–∏ —Ä–∞–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
        hash3 = CryptoManager.hash_data("Different message")
        assert hash1 != hash3
    
    def test_merkle_root(self):
        """–¢–µ—Å—Ç –¥–µ—Ä–µ–≤–∞ –ú–µ—Ä–∫–ª–∞"""
        # –¢–µ—Å—Ç —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º
        assert CryptoManager.merkle_root([]) == ""
        
        # –¢–µ—Å—Ç —Å –æ–¥–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º
        single_hash = "abc123"
        assert CryptoManager.merkle_root([single_hash]) == single_hash
        
        # –¢–µ—Å—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
        hashes = ["hash1", "hash2", "hash3", "hash4"]
        root = CryptoManager.merkle_root(hashes)
        assert isinstance(root, str)
        assert len(root) == 64  # SHA-256


class TestUTXOManager:
    """–¢–µ—Å—Ç—ã UTXO —Å–∏—Å—Ç–µ–º—ã"""
    
    def setup_method(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞"""
        self.utxo_manager = UTXOManager()
    
    def test_add_and_get_utxo(self):
        """–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è UTXO"""
        tx_id = "tx123"
        output = TransactionOutput(amount=50.0, recipient="alice")
        
        # –î–æ–±–∞–≤–ª—è–µ–º UTXO
        self.utxo_manager.add_utxo(tx_id, 0, output)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
        balance = self.utxo_manager.get_balance("alice")
        assert balance == 50.0
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º UTXO
        utxos = self.utxo_manager.get_utxos_for_address("alice")
        assert len(utxos) == 1
        assert utxos[0]["tx_id"] == tx_id
        assert utxos[0]["amount"] == 50.0
    
    def test_spend_utxo(self):
        """–¢–µ—Å—Ç —Ç—Ä–∞—Ç—ã UTXO"""
        tx_id = "tx123"
        output = TransactionOutput(amount=50.0, recipient="alice")
        
        # –î–æ–±–∞–≤–ª—è–µ–º UTXO
        self.utxo_manager.add_utxo(tx_id, 0, output)
        
        # –¢—Ä–∞—Ç–∏–º UTXO
        success = self.utxo_manager.spend_utxo(tx_id, 0)
        assert success is True
        
        # –ë–∞–ª–∞–Ω—Å –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å 0
        balance = self.utxo_manager.get_balance("alice")
        assert balance == 0.0
        
        # –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ç—Ä–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –Ω–µ –ø—Ä–æ–π—Ç–∏
        success_again = self.utxo_manager.spend_utxo(tx_id, 0)
        assert success_again is False
    
    def test_multiple_utxos(self):
        """–¢–µ—Å—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ UTXO"""
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ UTXO –¥–ª—è –æ–¥–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞
        self.utxo_manager.add_utxo("tx1", 0, TransactionOutput(amount=30.0, recipient="alice"))
        self.utxo_manager.add_utxo("tx2", 0, TransactionOutput(amount=20.0, recipient="alice"))
        self.utxo_manager.add_utxo("tx3", 1, TransactionOutput(amount=10.0, recipient="bob"))
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å—ã
        alice_balance = self.utxo_manager.get_balance("alice")
        bob_balance = self.utxo_manager.get_balance("bob")
        
        assert alice_balance == 50.0
        assert bob_balance == 10.0
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ UTXO
        alice_utxos = self.utxo_manager.get_utxos_for_address("alice")
        bob_utxos = self.utxo_manager.get_utxos_for_address("bob")
        
        assert len(alice_utxos) == 2
        assert len(bob_utxos) == 1


class TestBlockchain:
    """–¢–µ—Å—Ç—ã –±–ª–æ–∫—á–µ–π–Ω–∞"""
    
    def setup_method(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞"""
        self.blockchain = Blockchain()
    
    def test_genesis_block(self):
        """–¢–µ—Å—Ç –≥–µ–Ω–µ–∑–∏—Å –±–ª–æ–∫–∞"""
        assert len(self.blockchain.chain) == 1
        
        genesis_block = self.blockchain.chain[0]
        assert genesis_block.index == 0
        assert genesis_block.previous_hash == "0"
        assert len(genesis_block.transactions) == 1
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å genesis –∞–¥—Ä–µ—Å–∞
        balance = self.blockchain.utxo_manager.get_balance("genesis_address")
        assert balance == 1000.0
    
    def test_calculate_hash(self):
        """–¢–µ—Å—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ö–µ—à–∞ –±–ª–æ–∫–∞"""
        block = self.blockchain.chain[0]
        calculated_hash = self.blockchain.calculate_hash(block)
        
        assert isinstance(calculated_hash, str)
        assert len(calculated_hash) == 64
        assert calculated_hash == block.hash
    
    def test_transaction_validation(self):
        """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"""
        # –í–∞–ª–∏–¥–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç genesis
        genesis_utxos = self.blockchain.utxo_manager.get_utxos_for_address("genesis_address")
        
        valid_transaction = Transaction(
            id=str(uuid.uuid4()),
            inputs=[TransactionInput(
                tx_id=genesis_utxos[0]["tx_id"],
                output_index=genesis_utxos[0]["output_index"]
            )],
            outputs=[
                TransactionOutput(amount=50.0, recipient="alice"),
                TransactionOutput(amount=949.0, recipient="genesis_address")  # —Å–¥–∞—á–∞
            ],
            timestamp=time.time(),
            fee=1.0
        )
        
        is_valid = self.blockchain.validate_transaction(valid_transaction)
        assert is_valid is True
        
        # –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (–±–æ–ª—å—à–µ –≤—ã—Ö–æ–¥–æ–≤ —á–µ–º –≤—Ö–æ–¥–æ–≤)
        invalid_transaction = Transaction(
            id=str(uuid.uuid4()),
            inputs=[TransactionInput(
                tx_id=genesis_utxos[0]["tx_id"],
                output_index=genesis_utxos[0]["output_index"]
            )],
            outputs=[
                TransactionOutput(amount=2000.0, recipient="alice")  # –±–æ–ª—å—à–µ —á–µ–º –µ—Å—Ç—å
            ],
            timestamp=time.time(),
            fee=1.0
        )
        
        is_invalid = self.blockchain.validate_transaction(invalid_transaction)
        assert is_invalid is False
    
    def test_add_transaction(self):
        """–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"""
        genesis_utxos = self.blockchain.utxo_manager.get_utxos_for_address("genesis_address")
        
        transaction = Transaction(
            id=str(uuid.uuid4()),
            inputs=[TransactionInput(
                tx_id=genesis_utxos[0]["tx_id"],
                output_index=genesis_utxos[0]["output_index"]
            )],
            outputs=[
                TransactionOutput(amount=50.0, recipient="alice"),
                TransactionOutput(amount=949.0, recipient="genesis_address")
            ],
            timestamp=time.time(),
            fee=1.0
        )
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        success = self.blockchain.add_transaction(transaction)
        assert success is True
        assert len(self.blockchain.pending_transactions) == 1
        
        # –ü—ã—Ç–∞–µ–º—Å—è –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—É—é
        invalid_tx = Transaction(
            id=str(uuid.uuid4()),
            inputs=[TransactionInput(tx_id="nonexistent", output_index=0)],
            outputs=[TransactionOutput(amount=100.0, recipient="bob")],
            timestamp=time.time(),
            fee=1.0
        )
        
        success_invalid = self.blockchain.add_transaction(invalid_tx)
        assert success_invalid is False
        assert len(self.blockchain.pending_transactions) == 1  # –Ω–µ —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å
    
    def test_mine_block(self):
        """–¢–µ—Å—Ç –º–∞–π–Ω–∏–Ω–≥–∞ –±–ª–æ–∫–∞"""
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        genesis_utxos = self.blockchain.utxo_manager.get_utxos_for_address("genesis_address")
        
        transaction = Transaction(
            id=str(uuid.uuid4()),
            inputs=[TransactionInput(
                tx_id=genesis_utxos[0]["tx_id"],
                output_index=genesis_utxos[0]["output_index"]
            )],
            outputs=[
                TransactionOutput(amount=50.0, recipient="alice"),
                TransactionOutput(amount=949.0, recipient="genesis_address")
            ],
            timestamp=time.time(),
            fee=1.0
        )
        
        self.blockchain.add_transaction(transaction)
        
        # –ú–∞–π–Ω–∏–º –±–ª–æ–∫
        initial_chain_length = len(self.blockchain.chain)
        new_block = self.blockchain.mine_block(difficulty=1)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        assert len(self.blockchain.chain) == initial_chain_length + 1
        assert new_block.index == 1
        assert new_block.previous_hash == self.blockchain.chain[0].hash
        assert new_block.hash.startswith("0")  # difficulty=1
        assert len(self.blockchain.pending_transactions) == 0
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UTXO
        alice_balance = self.blockchain.utxo_manager.get_balance("alice")
        assert alice_balance == 50.0


class TestABTestManager:
    """–¢–µ—Å—Ç—ã A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    
    def setup_method(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞"""
        self.ab_manager = ABTestManager()
    
    def test_user_assignment(self):
        """–¢–µ—Å—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø—ã"""
        user_id = "user123"
        feature = "new_ui"
        
        # –ù–∞–∑–Ω–∞—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        group1 = self.ab_manager.assign_user_to_group(user_id, feature)
        group2 = self.ab_manager.assign_user_to_group(user_id, feature)
        
        # –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ
        assert group1 == group2
        assert isinstance(group1, ABTestGroup)
    
    def test_different_users_different_groups(self):
        """–¢–µ—Å—Ç —á—Ç–æ —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–ø–∞—Å—Ç—å –≤ —Ä–∞–∑–Ω—ã–µ –≥—Ä—É–ø–ø—ã"""
        feature = "new_ui"
        groups = set()
        
        # –ù–∞–∑–Ω–∞—á–∞–µ–º –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        for i in range(100):
            user_id = f"user{i}"
            group = self.ab_manager.assign_user_to_group(user_id, feature)
            groups.add(group)
        
        # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã
        assert len(groups) > 1
    
    def test_record_conversion(self):
        """–¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π"""
        user_id = "user123"
        feature = "new_ui"
        
        # –ù–∞–∑–Ω–∞—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        group = self.ab_manager.assign_user_to_group(user_id, feature)
        
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–Ω–≤–µ—Ä—Å–∏—é
        self.ab_manager.record_conversion(user_id, feature, True)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∑–∞–ø–∏—Å—å –¥–æ–±–∞–≤–∏–ª–∞—Å—å
        assert len(self.ab_manager.test_results) == 1
        
        result = self.ab_manager.test_results[0]
        assert result.user_id == user_id
        assert result.feature == feature
        assert result.group == group
        assert result.conversion is True
    
    def test_statistics(self):
        """–¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ A/B —Ç–µ—Å—Ç–æ–≤"""
        feature = "new_ui"
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        users_data = [
            ("user1", True),   # –∫–æ–Ω–≤–µ—Ä—Å–∏—è
            ("user2", False),  # –Ω–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
            ("user3", True),   # –∫–æ–Ω–≤–µ—Ä—Å–∏—è
            ("user4", False),  # –Ω–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
            ("user5", True),   # –∫–æ–Ω–≤–µ—Ä—Å–∏—è
        ]
        
        for user_id, converted in users_data:
            self.ab_manager.assign_user_to_group(user_id, feature)
            self.ab_manager.record_conversion(user_id, feature, converted)
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        stats = self.ab_manager.get_test_statistics(feature)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        assert isinstance(stats, dict)
        for group in ABTestGroup:
            assert group.value in stats
            group_stats = stats[group.value]
            assert "total_users" in group_stats
            assert "conversions" in group_stats
            assert "conversion_rate" in group_stats
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–µ —á–∏—Å–ª–∞
        total_users = sum(stats[group.value]["total_users"] for group in ABTestGroup)
        total_conversions = sum(stats[group.value]["conversions"] for group in ABTestGroup)
        
        assert total_users == 5
        assert total_conversions == 3  # 3 –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏–∑ 5


class TestIntegration:
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã"""
    
    def test_full_workflow(self):
        """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞"""
        # 1. –°–æ–∑–¥–∞–µ–º –±–ª–æ–∫—á–µ–π–Ω
        blockchain = Blockchain()
        
        # 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á–∏
        keys = CryptoManager.generate_key_pair()
        assert keys is not None
        
        # 3. –°–æ–∑–¥–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        genesis_utxos = blockchain.utxo_manager.get_utxos_for_address("genesis_address")
        
        transaction = Transaction(
            id=str(uuid.uuid4()),
            inputs=[TransactionInput(
                tx_id=genesis_utxos[0]["tx_id"],
                output_index=genesis_utxos[0]["output_index"]
            )],
            outputs=[
                TransactionOutput(amount=100.0, recipient="alice"),
                TransactionOutput(amount=899.0, recipient="genesis_address")
            ],
            timestamp=time.time(),
            fee=1.0
        )
        
        success = blockchain.add_transaction(transaction)
        assert success is True
        
        # 4. –ú–∞–π–Ω–∏–º –±–ª–æ–∫
        new_block = blockchain.mine_block(difficulty=1)
        assert new_block is not None
        assert len(blockchain.chain) == 2
        
        # 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
        alice_balance = blockchain.utxo_manager.get_balance("alice")
        assert alice_balance == 100.0
        
        # 6. A/B —Ç–µ—Å—Ç
        ab_manager = ABTestManager()
        group = ab_manager.assign_user_to_group("alice", "wallet_ui")
        ab_manager.record_conversion("alice", "wallet_ui", True)
        
        stats = ab_manager.get_test_statistics("wallet_ui")
        assert stats is not None
        
        print("‚úÖ –í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!")


if __name__ == "__main__":
    # –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
    print("–ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤...")
    
    # –¢–µ—Å—Ç –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏
    crypto_test = TestCryptoManager()
    crypto_test.test_digital_signature()
    print("‚úÖ –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç")
    
    # –¢–µ—Å—Ç UTXO
    utxo_test = TestUTXOManager()
    utxo_test.setup_method()
    utxo_test.test_spend_utxo()
    print("‚úÖ UTXO —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç")
    
    # –¢–µ—Å—Ç –±–ª–æ–∫—á–µ–π–Ω–∞
    blockchain_test = TestBlockchain()
    blockchain_test.setup_method()
    blockchain_test.test_genesis_block()
    print("‚úÖ –ë–ª–æ–∫—á–µ–π–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç")
    
    # –¢–µ—Å—Ç A/B
    ab_test = TestABTestManager()
    ab_test.setup_method()
    ab_test.test_user_assignment()
    print("‚úÖ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç")
    
    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç
    integration_test = TestIntegration()
    integration_test.test_full_workflow()
    
    print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã!")
    print("–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: python -m pytest test_blockchain.py -v")
